<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CookRecipesApp.View.AddRecepiePage"
             xmlns:viewmodel="clr-namespace:CookRecipesApp.ViewModel"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:sharpnado="clr-namespace:Sharpnado.MaterialFrame;assembly=Maui.MaterialFrame"
             xmlns:categoryModel="clr-namespace:CookRecipesApp.Model.Category"
             xmlns:recepieModel="clr-namespace:CookRecipesApp.Model.Recepie"
             xmlns:ingredientModel="clr-namespace:CookRecipesApp.Model.Ingredient"
             
             x:DataType="viewmodel:AddRecepieViewModel"
             Title="AddRecepiePage"
             Shell.NavBarIsVisible="False">
    
    

    <Grid
        RowDefinitions="*"
        ColumnDefinitions="*"
        BackgroundColor="#1f1f1f"
        MaximumWidthRequest="1300">
        <ScrollView
            Grid.Row="0" Grid.Column="0"
            Margin="10, 10">
            <Grid
                RowDefinitions="45, 60, 250, 90, Auto, Auto, 20, 70">
                <Label
                    Grid.Row="0"
                    Text="Recipe name"
                    FontFamily="Alegreya"
                    FontAttributes="Bold"
                    FontSize="30"
                    Margin="10, 0, 0, 0"/>
                <Border
                    Grid.Row="1"
                    StrokeShape="RoundRectangle, 20"
                    Stroke="Transparent"
                    BackgroundColor="#212121"
                    HeightRequest="50"
                    Margin="5, 0"
                    Shadow="6, 6, 10, Black, 0.2">
                    <Entry
                        FontSize="19"
                        TextColor="{StaticResource Porcelain}"
                        Text="{Binding Title}"
                        Margin="7, 0, 0, 0"/>
                </Border>
                <Grid
                    Grid.Row="2"
                    ColumnDefinitions="*, *">
                    <VerticalStackLayout
                        Grid.Row="0"
                        Grid.Column="1">
                        <Border
                            Margin="0, 10"
                            HeightRequest="180"
                            Stroke="{StaticResource Black}"
                            StrokeShape="RoundRectangle, 15"
                            StrokeThickness="1">
                            <Image Source="default_picture.png"/>
                        </Border>
                        <Button Text="Add photo" Background="{StaticResource PineTeal}" BorderColor="{StaticResource Evergreen}" BorderWidth="1"/>
                    </VerticalStackLayout>
                    <VerticalStackLayout
                        Grid.Column="0" Grid.Row="0">

                        <Label Margin="10, 0, 0, 5"  Text="Time" FontSize="20" FontFamily="Alegreya"/>
                        <Grid
                            ColumnDefinitions="*, 100">
                            <Border
                                Grid.Column="0"
                                StrokeShape="RoundRectangle, 20"
                                Stroke="Transparent"
                                BackgroundColor="#212121"
                                Margin="0, 0, 7, 0">
                                <Entry Keyboard="Numeric" TextColor="{StaticResource Porcelain}" Margin="05, 0, 0, 0" Text="{Binding Time}"/>
                            </Border>
                            <Label Grid.Column="1" Text="Minutes" VerticalOptions="Center" HorizontalOptions="Start"/>
                        </Grid>

                        <Label Margin="10, 5, 0, 5"  Text="Servings" FontSize="20" FontFamily="Alegreya"/>
                        <Grid
                            ColumnDefinitions="*, 100">
                            <Border
                                Grid.Column="0"
                                StrokeShape="RoundRectangle, 20"
                                Stroke="Transparent"
                                BackgroundColor="#212121"
                                Margin="0, 0, 7, 0">
                                <Entry Keyboard="Numeric" TextColor="{StaticResource Porcelain}" Margin="05, 0, 0, 0" Text="{Binding Servings}"/>
                            </Border>
                            <Picker Grid.Column="1" TextColor="{StaticResource Porcelain}" Margin="5, 0" ItemsSource="{Binding ServingUnits}" SelectedItem="{Binding SelectedServingUnit}" TitleColor="{StaticResource Porcelain}" Title="Select unit" ItemDisplayBinding="{Binding Name}"/>
                        </Grid>

                        <Label Margin="10, 5, 0, 5"  Text="Difficulty" FontSize="20" FontFamily="Alegreya"/>
                        <Border
                                Grid.Column="0"
                                StrokeShape="RoundRectangle, 20"
                                Stroke="Transparent"
                                BackgroundColor="#212121"
                                Margin="0, 0, 7, 0">
                            <Picker Grid.Column="1" TextColor="{StaticResource Porcelain}" Margin="5, 0" ItemsSource="{Binding DifficultyOptions}" SelectedItem="{Binding Difficulty}" TitleColor="{StaticResource Porcelain}"  Title="Select difficulty"/>
                        </Border>
                    </VerticalStackLayout>

                </Grid>

                <Grid
                    Grid.Row="3"
                    RowDefinitions="37, *"
                    BackgroundColor="Transparent">
                    <Label Margin="10, 0, 0, 5"  Text="Categories" FontSize="20" FontFamily="Alegreya" VerticalOptions="End"/>

                    <CollectionView ItemsSource="{Binding Categories}" Grid.Row="1">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Horizontal"></LinearItemsLayout>
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate >
                            <DataTemplate x:DataType="categoryModel:Category">
                                <Button
                                    Text="{Binding Name}"
                                    Margin="5" 
                                    BorderColor="{StaticResource Evergreen}" 
                                    BorderWidth="1"
                                    BackgroundColor="#212121" 
                                   Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:AddRecepieViewModel}}, Path=CategoryBtnCommand}"
                                    CommandParameter="{Binding .}">
                                    <Button.Triggers>
                                        <DataTrigger TargetType="Button" Binding="{Binding IsSelected}" Value="True">
                                            <Setter Property="BackgroundColor" Value="{StaticResource PineTeal}"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Button" Binding="{Binding IsSelected}" Value="False">
                                            <Setter Property="BackgroundColor" Value="#212121" />
                                        </DataTrigger>
                                    </Button.Triggers>

                                </Button>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>

                <Grid
                    Grid.Row="4"
                    RowDefinitions="40, Auto, 47">
                    <Label 
                        Grid.Row="0" 
                        Text="Ingredients" 
                        FontSize="20" 
                        FontFamily="Alegreya"
                        TextColor="{StaticResource Porcelain}"
                        Margin="10, 5, 0, 5"/>

                    <CollectionView ItemsSource="{Binding Ingredients}" Grid.Row="1" MinimumHeightRequest="80">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="recepieModel:RecepieIngredient">
                                <Grid 
                                    MaximumHeightRequest="44"
                                    ColumnDefinitions="Auto, 50, *, 60"
                                    Margin="0,2">
                                    <Border
                                        Grid.Column="0"
                                        StrokeShape="RoundRectangle, 20"
                                        Stroke="Transparent"
                                        BackgroundColor="#212121"
                                        Margin="0, 0, 4, 0">
                                        <Entry Keyboard="Numeric" TextColor="{StaticResource Porcelain}" Margin="5, 0, 0, 0" Text="{Binding Quantity}"/>
                                    </Border>
                                    <Picker Grid.Column="1" ItemsSource="{Binding Ingredient.PossibleUnits}" ItemDisplayBinding="{Binding Name}" SelectedItem="{Binding SelectedUnit}" TextColor="{StaticResource Porcelain}" Margin="0, 0, 10, 0"  VerticalOptions="Center"/>
                                    <Label Grid.Column="2" Text="{Binding Ingredient.Name}" TextColor="{StaticResource Porcelain}" VerticalOptions="Center"/>
                                    <Button 
                                        Grid.Column="3" 
                                        FontSize="15" 
                                        VerticalOptions="Center"
                                        BackgroundColor="#212121" 
                                        FontAttributes="Bold" 
                                        WidthRequest="30"
                                        Margin="2"
                                        BorderColor="{StaticResource Evergreen}"
                                        BorderWidth="1"
                                        HorizontalOptions="Center"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DelIngredientBtnCommand}"
                                        CommandParameter="{Binding .}" />
                                    <Label Text="x" Grid.Column="3" VerticalOptions="Center" HorizontalOptions="Center"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Button
                        Grid.Row="2"
                        BackgroundColor="{StaticResource PineTeal}"
                        HorizontalOptions="End"
                        WidthRequest="70"
                        Margin="0, 7, 20, 0"
                        Text="Add"
                        Command="{Binding OpenAddIngredientPopupCommand}"
                        BorderColor="{StaticResource Evergreen}"
                        BorderWidth="1"/>

                </Grid>
                <Grid
                    Grid.Row="5"
                    RowDefinitions="40, Auto, 47">
                    <Label 
                        Grid.Row="0" 
                        Text="Cooking process" 
                        FontSize="20" 
                        FontFamily="Alegreya"
                        TextColor="{StaticResource Porcelain}"
                        Margin="10, 5, 0, 5"/>

                    <CollectionView ItemsSource="{Binding RecepieSteps}" Grid.Row="1">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="recepieModel:RecepieStep">
                                <Border
                                    StrokeShape="RoundRectangle, 7"
                                    Stroke="Transparent"
                                    BackgroundColor="Transparent">
                                    <Grid 
                                        ColumnDefinitions="20,*"
                                        Margin="0,2"
                                        MinimumHeightRequest="100">
                                        <Label
                                            Grid.Column="0"
                                            Text="{Binding Order}"
                                            HorizontalOptions="Center"
                                            FontFamily="Alegreya"
                                            FontAttributes="Bold"
                                            FontSize="25"
                                            Margin="0, 5, 0, 0"/>
                                        <Border
                                            Grid.Column="1"
                                            BackgroundColor="#212121"
                                            StrokeShape="RoundRectangle, 20"
                                            Stroke="Transparent"
                                            Padding="7, 3">
                                            <Editor  TextColor="{StaticResource Porcelain}" Text="{Binding ContentText}" AutoSize="TextChanges"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Grid
                        Grid.Row="2"
                        ColumnDefinitions="*,97, 97"
                        >
                        <Button
                            Grid.Column="1"
                            BackgroundColor="{StaticResource PineTeal}"
                            WidthRequest="90"
                            Margin="0, 7, 0, 0"
                            Text="Remove"
                            Command="{Binding RemoveCookingStepBtnCommand}"
                            BorderColor="{StaticResource Evergreen}"
                            BorderWidth="1"/>
                        <Button
                            Grid.Column="2"
                            BackgroundColor="{StaticResource PineTeal}"
                            WidthRequest="70"
                            Margin="0, 7, 20, 0"
                            Text="Add"
                            Command="{Binding AddCookingStepBtnCommand}"
                            BorderColor="{StaticResource Evergreen}"
                            BorderWidth="1"/>

                    </Grid>


                </Grid>

                <Label
                    Grid.Row="6"
                    TextColor="DarkRed"
                    FontFamily="Nunito"
                    FontAttributes="Bold"
                    FontSize="15"
                    Margin="15, 0, 0, 0"
                    Text="{Binding WarningText}"
                    IsVisible="{Binding WarningEnabled}"
                    />

                <Button
                    Grid.Row="7"
                    Margin="60, 13"
                    BackgroundColor="{StaticResource PineTeal}"
                    BorderColor="{StaticResource Evergreen}"
                    BorderWidth="1"
                    Text="Finish recepie"
                    Command="{Binding FinishRecepieBtnCommand}"/>




            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>